package com.gmcc.webapp.action.sys;

import java.io.IOException;
import java.io.OutputStream;
import java.net.URLEncoder;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import net.sf.json.JSONObject;

import com.gmcc.util.ExcelOperate;

public class RoleMenuExportServlet extends HttpServlet {
	private static final long serialVersionUID = 7379249810296221244L;

	public void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
	   	String tableData = request.getParameter("tableData");
	//	String tableData = "{'widths':[0],'data':[{'height':22,'cell':[{'text':'2011-09到2011-11仓库及物流商任务单总的完成情况','range':'1.12','clazz':'desc','style':'TEXT-ALIGN: center'}]},{'height':43,'cell':[{'text':'处理方','range':'2.1','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'当前状态','range':'2.1','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'2011-09月份','range':'1.2','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'2011-09月份 汇总','range':'2.1','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'2011-10月份','range':'1.2','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'2011-10月份 汇总','range':'2.1','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'2011-11月份','range':'1.2','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'2011-11月份 汇总','range':'2.1','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'总计','range':'2.1','clazz':'desc','style':'TEXT-ALIGN: center'}]},{'height':22,'cell':[{'text':'超时','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'未超时','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'超时','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'未超时','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'超时','clazz':'desc','style':'TEXT-ALIGN: center'},{'text':'未超时','clazz':'desc','style':'TEXT-ALIGN: center'}]},{'height':120,'cell':[{'text':'无处理方','range':'4.1','style':'TEXT-ALIGN: center'},{'text':'已发布待处理','style':'TEXT-ALIGN: center'},{'text':'2'},{'text':'0'},{'text':'2'},{'text':'5'},{'text':'2'},{'text':'7'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'9'}]},{'height':21,'cell':[{'text':'草稿','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'2'},{'text':'0'},{'text':'2'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'2'}]},{'height':21,'cell':[{'text':'处理中','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'2'},{'text':'0'},{'text':'2'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'2'}]},{'height':38,'cell':[{'text':'通过确认','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'6'},{'text':'6'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'6'}]},{'height':137,'cell':[{'text':'江门','range':'4.1','style':'TEXT-ALIGN: center'},{'text':'已发布待处理','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'3'},{'text':'1'},{'text':'4'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'4'}]},{'height':38,'cell':[{'text':'处理人已提交','style':'TEXT-ALIGN: center'},{'text':'1'},{'text':'0'},{'text':'1'},{'text':'1'},{'text':'6'},{'text':'7'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'8'}]},{'height':21,'cell':[{'text':'处理中','style':'TEXT-ALIGN: center'},{'text':'1'},{'text':'0'},{'text':'1'},{'text':'10'},{'text':'0'},{'text':'10'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'11'}]},{'height':38,'cell':[{'text':'通过确认','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'1'},{'text':'1'},{'text':'2'},{'text':'7'},{'text':'9'},{'text':'0'},{'text':'1'},{'text':'1'},{'text':'11'}]},{'height':115,'cell':[{'text':'埃瑞普','range':'3.1','style':'TEXT-ALIGN: center'},{'text':'处理人已提交','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'1'},{'text':'0'},{'text':'1'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'1'}]},{'height':38,'cell':[{'text':'已发布待处理','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'1'},{'text':'0'},{'text':'1'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'1'}]},{'height':38,'cell':[{'text':'通过确认','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'2'},{'text':'2'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'2'}]},{'height':77,'cell':[{'text':'江门测试仓库','range':'2.1','style':'TEXT-ALIGN: center'},{'text':'已发布待处理','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'1'},{'text':'0'},{'text':'1'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'1'}]},{'height':38,'cell':[{'text':'通过确认','style':'TEXT-ALIGN: center'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'1'},{'text':'1'},{'text':'0'},{'text':'0'},{'text':'0'},{'text':'1'}]}],'style':'TEXT-ALIGN: center','name':'任务超时统计报表'}";
		
	   	//String tableData ="{"widths":[0],"data":[{"height":22,"cell":[{"text":"2011-09到2011-11仓库及物流商任务单总的完成情况","range":"1.12","clazz":"desc"}]},{"height":71,"cell":[{"text":"处理方","range":"2.1","clazz":"desc"},{"text":"当前状态","range":"2.1","clazz":"desc"},{"text":"2011-09月份","range":"1.2","clazz":"desc"},{"text":"2011-09月份 汇总","range":"2.1","clazz":"desc"},{"text":"2011-10月份","range":"1.2","clazz":"desc"},{"text":"2011-10月份 汇总","range":"2.1","clazz":"desc"},{"text":"2011-11月份","range":"1.2","clazz":"desc"},{"text":"2011-11月份 汇总","range":"2.1","clazz":"desc"},{"text":"总计","range":"2.1","clazz":"desc"}]},{"height":51,"cell":[{"text":"超时","clazz":"desc"},{"text":"未超时","clazz":"desc"},{"text":"超时","clazz":"desc"},{"text":"未超时","clazz":"desc"},{"text":"超时","clazz":"desc"},{"text":"未超时","clazz":"desc"}]},{"height":103,"cell":[{"text":"无处理方","range":"4.1"},{"text":"已发布\/待处理"},{"text":"2"},{"text":"0"},{"text":"2"},{"text":"5"},{"text":"2"},{"text":"7"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"9"}]},{"height":21,"cell":[{"text":"草稿"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"2"},{"text":"0"},{"text":"2"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"2"}]},{"height":21,"cell":[{"text":"处理中"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"2"},{"text":"0"},{"text":"2"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"2"}]},{"height":21,"cell":[{"text":"通过确认"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"6"},{"text":"6"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"6"}]},{"height":118,"cell":[{"text":"江门","range":"4.1"},{"text":"已发布\/待处理"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"3"},{"text":"1"},{"text":"4"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"4"}]},{"height":36,"cell":[{"text":"处理人已提交"},{"text":"1"},{"text":"0"},{"text":"1"},{"text":"1"},{"text":"6"},{"text":"7"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"8"}]},{"height":21,"cell":[{"text":"处理中"},{"text":"1"},{"text":"0"},{"text":"1"},{"text":"10"},{"text":"0"},{"text":"10"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"11"}]},{"height":21,"cell":[{"text":"通过确认"},{"text":"0"},{"text":"1"},{"text":"1"},{"text":"2"},{"text":"7"},{"text":"9"},{"text":"0"},{"text":"1"},{"text":"1"},{"text":"11"}]},{"height":96,"cell":[{"text":"埃瑞普","range":"3.1"},{"text":"处理人已提交"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"1"},{"text":"0"},{"text":"1"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"1"}]},{"height":36,"cell":[{"text":"已发布\/待处理"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"1"},{"text":"0"},{"text":"1"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"1"}]},{"height":21,"cell":[{"text":"通过确认"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"2"},{"text":"2"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"2"}]},{"height":78,"cell":[{"text":"江门测试仓库","range":"2.1"},{"text":"已发布\/待处理"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"1"},{"text":"0"},{"text":"1"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"1"}]},{"height":29,"cell":[{"text":"通过确认"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"1"},{"text":"1"},{"text":"0"},{"text":"0"},{"text":"0"},{"text":"1"}]}],"name":"任务超时统计报表"}";
	   	OutputStream os = response.getOutputStream();
		response.setBufferSize(1000000);
	   	
	   	JSONObject jsonObj = JSONObject.fromObject(tableData);
		
	   ExcelOperate excelOperate = new ExcelOperate();
	   
	   	String name = excelOperate.buildExcel(jsonObj, os);
	   	
	   	if (name == null)
	   		name = "export";
	   			
		response.setContentType("application/vnd.ms-excel;charset=utf-8");
		response.setHeader("Content-Disposition", "attachment; filename=" + URLEncoder.encode(name, "UTF-8") + ".xls");
	}
}
